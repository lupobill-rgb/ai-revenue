{
  "agent_name": "cmo_optimizer",
  "version": "2.0.0",
  "description": "Analyzes campaign performance and generates actionable optimization recommendations",
  "model": "google/gemini-2.5-flash",
  "temperature": 0.5,
  "system_prompt": "You are an expert marketing optimization AI for a multi-tenant SaaS platform. Your role is to analyze campaign performance metrics and current assets, then recommend specific, actionable changes to improve results.\n\nGuidelines:\n- Focus on the stated campaign goal (leads, meetings, revenue, engagement)\n- Respect all constraints provided by the tenant\n- Prioritize high-impact, low-effort changes\n- Be specific - provide actual new copy, not just 'improve this'\n- Consider the full funnel from awareness to conversion\n- Never reference other tenants or leak cross-tenant data\n- Output ONLY valid JSON matching the exact schema requested\n\nChange types you can recommend:\n- update_email: Modify email subject lines or body copy\n- update_sms: Modify SMS message text\n- update_post: Modify social post content\n- update_voice_script: Modify voice agent scripts\n- adjust_wait: Change timing/delays between steps\n- kill_variant: Archive underperforming content variants\n- add_step: Recommend adding a new automation step\n- remove_step: Recommend removing an ineffective step",
  "input_schema": {
    "type": "object",
    "required": ["tenant_id", "campaign_id", "goal", "metrics"],
    "properties": {
      "tenant_id": {
        "type": "string",
        "format": "uuid",
        "description": "Tenant identifier for multi-tenant isolation"
      },
      "workspace_id": {
        "type": "string",
        "format": "uuid",
        "description": "Workspace identifier"
      },
      "campaign_id": {
        "type": "string",
        "format": "uuid",
        "description": "Campaign to optimize"
      },
      "goal": {
        "type": "string",
        "enum": ["leads", "meetings", "revenue", "engagement"],
        "description": "Primary campaign goal"
      },
      "metrics": {
        "type": "object",
        "properties": {
          "opens": { "type": "integer" },
          "clicks": { "type": "integer" },
          "replies": { "type": "integer" },
          "booked_meetings": { "type": "integer" },
          "no_shows": { "type": "integer" },
          "voice_calls": {
            "type": "object",
            "properties": {
              "total": { "type": "integer" },
              "reached": { "type": "integer" },
              "booked": { "type": "integer" }
            }
          }
        }
      },
      "assets": {
        "type": "object",
        "properties": {
          "emails": { "type": "array" },
          "sms": { "type": "array" },
          "posts": { "type": "array" },
          "landing_pages": { "type": "array" },
          "voice_scripts": { "type": "array" }
        }
      },
      "constraints": {
        "type": "array",
        "items": { "type": "string" },
        "description": "Optimization constraints (e.g., 'Do not change brand voice')"
      }
    }
  },
  "output_schema": {
    "type": "object",
    "required": ["changes", "summary"],
    "properties": {
      "changes": {
        "type": "array",
        "items": {
          "type": "object",
          "required": ["type", "target_id", "reason"],
          "properties": {
            "type": {
              "type": "string",
              "enum": ["update_email", "update_sms", "update_post", "update_voice_script", "adjust_wait", "kill_variant", "add_step", "remove_step"]
            },
            "target_id": { "type": "string" },
            "reason": { "type": "string" },
            "new_subject": { "type": "string" },
            "new_body": { "type": "string" },
            "new_message": { "type": "string" },
            "new_script": { "type": "string" },
            "new_delay_hours": { "type": "integer" },
            "metadata": { "type": "object" }
          }
        }
      },
      "summary": {
        "type": "string",
        "description": "Brief summary of all optimizations and expected impact"
      },
      "priority_actions": {
        "type": "array",
        "items": { "type": "string" },
        "description": "Top 3 most impactful changes to implement first"
      },
      "metrics_targets": {
        "type": "object",
        "properties": {
          "expected_open_rate_improvement": { "type": "string" },
          "expected_reply_rate_improvement": { "type": "string" },
          "expected_meeting_rate_improvement": { "type": "string" }
        }
      }
    }
  },
  "db_tables": ["campaign_optimizations", "cmo_campaigns", "cmo_content_assets", "cmo_recommendations"],
  "edge_function": "cmo-optimizer"
}
