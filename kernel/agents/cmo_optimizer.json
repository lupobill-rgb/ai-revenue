{
  "id": "cmo_optimizer",
  "agent_name": "CMO Optimization Agent",
  "module": "ai_cmo",
  "version": "2.1.0",
  "description": "Analyzes campaign performance and generates actionable optimization changesets to improve results",
  "model": "google/gemini-2.5-flash",
  "temperature": 0.4,
  "system_prompt": "You are the Optimization Agent for an AI marketing OS.\n\nYour job is to continuously optimize multi-channel B2B campaigns for a specific tenant.\nYou receive:\n- The campaign goal,\n- Recent performance metrics,\n- Current assets (emails, SMS, posts, landing pages, voice scripts),\n- Channel and compliance constraints.\n\nYou MUST:\n- Focus strictly on improving performance relative to the goal (leads, meetings, revenue, or engagement).\n- Propose specific, actionable changes that the system can apply.\n- Avoid random, high-risk experiments.\n- Preserve tenant's brand voice and constraints.\n- Never propose illegal, misleading, or spammy behavior.\n\nYou never talk to end users. You only return a JSON CHANGESET.\nDo not rewrite the entire campaign; only touch parts that need improvement.\nIf the campaign is already performing well, propose minimal or no changes and say so in \"summary\".\n\nYou must respond with a SINGLE valid JSON object only.\nDo not include explanations, comments, or extra keys.",
  "input_schema": {
    "type": "object",
    "required": ["tenant_id", "campaign_id", "goal", "metrics", "assets"],
    "properties": {
      "tenant_id": {
        "type": "string",
        "format": "uuid",
        "description": "Tenant identifier for multi-tenant isolation"
      },
      "workspace_id": {
        "type": "string",
        "format": "uuid",
        "description": "Workspace identifier"
      },
      "campaign_id": {
        "type": "string",
        "format": "uuid",
        "description": "Campaign to optimize"
      },
      "goal": {
        "type": "string",
        "enum": ["leads", "meetings", "revenue", "engagement"],
        "description": "Primary campaign goal"
      },
      "metrics": {
        "type": "object",
        "description": "Recent performance metrics",
        "properties": {
          "opens": { "type": "integer", "description": "Email opens" },
          "clicks": { "type": "integer", "description": "Link clicks" },
          "replies": { "type": "integer", "description": "Email/SMS replies" },
          "booked_meetings": { "type": "integer", "description": "Meetings booked" },
          "no_shows": { "type": "integer", "description": "Meeting no-shows" },
          "conversions": { "type": "integer", "description": "Goal conversions" },
          "voice_calls": {
            "type": "object",
            "properties": {
              "total": { "type": "integer", "description": "Total calls attempted" },
              "reached": { "type": "integer", "description": "Calls where lead answered" },
              "booked": { "type": "integer", "description": "Calls resulting in booking" },
              "no_answer": { "type": "integer", "description": "Calls with no answer" }
            }
          }
        }
      },
      "assets": {
        "type": "object",
        "description": "Current campaign assets with optional performance data",
        "properties": {
          "emails": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["id", "subject", "body"],
              "properties": {
                "id": { "type": "string" },
                "subject": { "type": "string" },
                "body": { "type": "string" },
                "performance": { "type": "object", "description": "Per-asset metrics" }
              }
            }
          },
          "sms": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["id", "body"],
              "properties": {
                "id": { "type": "string" },
                "body": { "type": "string" },
                "performance": { "type": "object" }
              }
            }
          },
          "posts": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["id", "body"],
              "properties": {
                "id": { "type": "string" },
                "body": { "type": "string" },
                "performance": { "type": "object" }
              }
            }
          },
          "landing_sections": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["id", "type", "heading", "body"],
              "properties": {
                "id": { "type": "string" },
                "type": { "type": "string" },
                "heading": { "type": "string" },
                "body": { "type": "string" },
                "performance": { "type": "object" }
              }
            }
          },
          "voice_scripts": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["id", "scenario", "script"],
              "properties": {
                "id": { "type": "string" },
                "scenario": { "type": "string" },
                "script": { "type": "string" },
                "performance": { "type": "object" }
              }
            }
          }
        }
      },
      "constraints": {
        "type": "array",
        "items": { "type": "string" },
        "description": "Optimization constraints (e.g., max touches, sending windows, compliance rules)"
      }
    }
  },
  "output_schema": {
    "type": "object",
    "required": ["changes", "summary"],
    "properties": {
      "changes": {
        "type": "array",
        "description": "List of 0 or more specific changes to apply",
        "items": {
          "oneOf": [
            {
              "type": "object",
              "required": ["type", "target_id", "reason", "new_subject", "new_body"],
              "properties": {
                "type": { "const": "update_email" },
                "target_id": { "type": "string" },
                "reason": { "type": "string" },
                "new_subject": { "type": "string" },
                "new_body": { "type": "string" }
              }
            },
            {
              "type": "object",
              "required": ["type", "target_id", "reason", "new_body"],
              "properties": {
                "type": { "const": "update_sms" },
                "target_id": { "type": "string" },
                "reason": { "type": "string" },
                "new_body": { "type": "string" }
              }
            },
            {
              "type": "object",
              "required": ["type", "target_id", "reason", "new_delay_hours"],
              "properties": {
                "type": { "const": "adjust_wait" },
                "target_id": { "type": "string" },
                "reason": { "type": "string" },
                "new_delay_hours": { "type": "number" }
              }
            },
            {
              "type": "object",
              "required": ["type", "target_id", "reason"],
              "properties": {
                "type": { "const": "kill_variant" },
                "target_id": { "type": "string" },
                "reason": { "type": "string" }
              }
            },
            {
              "type": "object",
              "required": ["type", "target_id", "reason", "new_body"],
              "properties": {
                "type": { "const": "update_post" },
                "target_id": { "type": "string" },
                "reason": { "type": "string" },
                "new_body": { "type": "string" }
              }
            },
            {
              "type": "object",
              "required": ["type", "target_id", "reason", "new_heading", "new_body"],
              "properties": {
                "type": { "const": "update_landing_section" },
                "target_id": { "type": "string" },
                "reason": { "type": "string" },
                "new_heading": { "type": "string" },
                "new_body": { "type": "string" }
              }
            },
            {
              "type": "object",
              "required": ["type", "target_id", "reason", "new_script"],
              "properties": {
                "type": { "const": "update_voice_script" },
                "target_id": { "type": "string" },
                "reason": { "type": "string" },
                "new_script": { "type": "string" }
              }
            }
          ]
        }
      },
      "summary": {
        "type": "string",
        "description": "Human-readable short explanation of what was optimized and why"
      }
    }
  },
  "db_tables": ["campaign_optimizations", "cmo_campaigns", "cmo_content_assets", "cmo_recommendations"],
  "edge_function": "cmo-optimizer"
}
